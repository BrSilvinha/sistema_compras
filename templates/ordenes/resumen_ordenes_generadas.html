{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="display-6 fw-bold text-success mb-2">
                        <i class="bi bi-check-circle me-3"></i>Órdenes Generadas Exitosamente
                    </h1>
                    <p class="text-muted mb-0">Resumen de las órdenes creadas para {{ requerimiento.codigo }}</p>
                </div>
                <a href="{% url 'mis_ordenes_generadas' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-list me-2"></i>Ver Todas Mis Órdenes
                </a>
            </div>
        </div>
    </div>

    <!-- Información del requerimiento -->
    <div class="card shadow-sm border-0 rounded-3 mb-4">
        <div class="card-header bg-success bg-opacity-5 border-0 py-3">
            <h5 class="card-title mb-0 text-success fw-semibold">
                <i class="bi bi-info-circle me-2"></i>Información del Requerimiento Original
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-clipboard-check text-success fs-1"></i>
                        <div class="mt-2">
                            <small class="text-muted d-block">Código</small>
                            <strong class="text-success">{{ requerimiento.codigo }}</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-building text-success fs-1"></i>
                        <div class="mt-2">
                            <small class="text-muted d-block">Área Solicitante</small>
                            <strong>{{ requerimiento.departamento.nombre }}</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-person text-success fs-1"></i>
                        <div class="mt-2">
                            <small class="text-muted d-block">Solicitante</small>
                            <strong>{{ requerimiento.solicitante.get_full_name }}</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-calendar3 text-success fs-1"></i>
                        <div class="mt-2">
                            <small class="text-muted d-block">Fecha Original</small>
                            <strong>{{ requerimiento.fecha|date:"d/m/Y" }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumen estadístico -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card border-0 bg-primary bg-opacity-10">
                <div class="card-body text-center py-3">
                    <i class="bi bi-receipt text-primary fs-1"></i>
                    <div class="mt-2">
                        <h4 class="text-primary fw-bold mb-0">{{ ordenes|length }}</h4>
                        <small class="text-primary">Orden{{ ordenes|length|pluralize:"es" }} Generada{{ ordenes|length|pluralize:"s" }}</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 bg-info bg-opacity-10">
                <div class="card-body text-center py-3">
                    <i class="bi bi-truck text-info fs-1"></i>
                    <div class="mt-2">
                        <h4 class="text-info fw-bold mb-0">{{ ordenes|length }}</h4>
                        <small class="text-info">Proveedor{{ ordenes|length|pluralize:"es" }} Involucrado{{ ordenes|length|pluralize:"s" }}</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 bg-success bg-opacity-10">
                <div class="card-body text-center py-3">
                    <i class="bi bi-currency-dollar text-success fs-1"></i>
                    <div class="mt-2">
                        <h4 class="text-success fw-bold mb-0">
                            ${% for orden in ordenes %}{{ orden.total|add:0 }}{% if not forloop.last %} + {% endif %}{% endfor %}
                        </h4>
                        <small class="text-success">Monto Total</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Órdenes generadas -->
    {% for orden in ordenes %}
    <div class="card shadow-sm border-0 rounded-3 mb-4">
        <div class="card-header bg-primary bg-opacity-5 border-0 py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0 text-primary fw-semibold">
                    <i class="bi bi-receipt me-2"></i>Orden {{ orden.codigo }}
                </h5>
                <span class="badge bg-success bg-opacity-15 text-success border border-success border-opacity-25 rounded-pill px-3 py-2">
                    <i class="bi bi-check-circle me-1"></i>Generada
                </span>
            </div>
        </div>
        
        <div class="card-body">
            <!-- Información del proveedor -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-building text-primary me-3 fs-3"></i>
                        <div>
                            <h6 class="fw-bold mb-1">{{ orden.proveedor.razon_social }}</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">RUC:</small><br>
                                    <span class="text-secondary">{{ orden.proveedor.ruc }}</span>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Fecha Emisión:</small><br>
                                    <span class="text-secondary">{{ orden.fecha_emision|date:"d/m/Y" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="mb-2">
                        <small class="text-muted d-block">Total de la Orden</small>
                        <span class="h4 text-success fw-bold mb-0">${{ orden.total }}</span>
                    </div>
                </div>
            </div>

            <!-- Productos de la orden -->
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="px-3 py-3 fw-semibold">
                                <i class="bi bi-box me-2"></i>Producto
                            </th>
                            <th class="px-3 py-3 fw-semibold text-center">
                                <i class="bi bi-123 me-2"></i>Cantidad
                            </th>
                            <th class="px-3 py-3 fw-semibold text-end">
                                <i class="bi bi-currency-dollar me-2"></i>Precio Unitario
                            </th>
                            <th class="px-3 py-3 fw-semibold text-end">
                                <i class="bi bi-calculator me-2"></i>Subtotal
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detalle in orden.detalles.all %}
                        <tr class="border-bottom">
                            <td class="px-3 py-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-box-seam text-primary me-2"></i>
                                    <div>
                                        <span class="fw-semibold">{{ detalle.producto.nombre }}</span>
                                        <br>
                                        <small class="text-muted">{{ detalle.producto.categoria.nombre }}</small>
                                    </div>
                                </div>
                            </td>
                            <td class="px-3 py-3 text-center">
                                <span class="badge bg-light text-dark border rounded-pill px-3 py-2">
                                    {{ detalle.cantidad }}
                                </span>
                            </td>
                            <td class="px-3 py-3 text-end">
                                <span class="text-secondary">${{ detalle.precio_unitario }}</span>
                            </td>
                            <td class="px-3 py-3 text-end">
                                <span class="fw-bold text-success">${{ detalle.subtotal }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="table-light">
                        <tr>
                            <th colspan="3" class="px-3 py-3 text-end">Total de la Orden:</th>
                            <th class="px-3 py-3 text-end">
                                <span class="text-success fs-5 fw-bold">${{ orden.total }}</span>
                            </th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- Información de seguimiento -->
    <div class="alert alert-success border-0 bg-success bg-opacity-10 rounded-3 mb-4">
        <div class="d-flex align-items-start">
            <i class="bi bi-check-circle text-success me-3 mt-1 fs-4"></i>
            <div>
                <h6 class="alert-heading text-success mb-2">¡Órdenes generadas exitosamente!</h6>
                <ul class="mb-0 text-success">
                    <li>Las órdenes han sido enviadas automáticamente a los proveedores</li>
                    <li>Puedes realizar el seguimiento individual de cada orden</li>
                    <li>Los proveedores podrán confirmar la recepción y programar entregas</li>
                    <li>Recibirás notificaciones sobre el estado de cada orden</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Acciones disponibles -->
    <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-info bg-opacity-5 border-0 py-3">
            <h5 class="card-title mb-0 text-info fw-semibold">
                <i class="bi bi-gear me-2"></i>¿Qué hacer ahora?
            </h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <a href="{% url 'mis_ordenes_generadas' %}" class="btn btn-outline-primary w-100 py-3">
                        <i class="bi bi-list me-2"></i>
                        <div>
                            <div class="fw-semibold">Ver Todas Mis Órdenes</div>
                            <small class="text-muted">Consultar el historial completo</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{% url 'lista_requerimientos_aprobados' %}" class="btn btn-outline-success w-100 py-3">
                        <i class="bi bi-clipboard-check me-2"></i>
                        <div>
                            <div class="fw-semibold">Procesar Más Requerimientos</div>
                            <small class="text-muted">Continuar con otros pendientes</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-4">
                    <a href="{% url 'lista_ordenes' %}" class="btn btn-outline-info w-100 py-3">
                        <i class="bi bi-eye me-2"></i>
                        <div>
                            <div class="fw-semibold">Seguimiento Global</div>
                            <small class="text-muted">Ver todas las órdenes del sistema</small>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navegación rápida -->
    <div class="text-center mt-4">
        <div class="card border-0 bg-transparent">
            <div class="card-body py-2">
                <div class="d-flex justify-content-center gap-4 flex-wrap">
                    <a href="{% url 'lista_requerimientos_aprobados' %}" class="text-decoration-none small">
                        <i class="bi bi-clipboard-check me-1"></i>Requerimientos Pendientes
                    </a>
                    <a href="{% url 'mis_ordenes_generadas' %}" class="text-decoration-none small">
                        <i class="bi bi-receipt me-1"></i>Mis Órdenes
                    </a>
                    <a href="{% url 'lista_ordenes' %}" class="text-decoration-none small">
                        <i class="bi bi-list me-1"></i>Todas las Órdenes
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}